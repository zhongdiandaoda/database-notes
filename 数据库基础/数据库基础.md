# SQL

数据库(database)：保存有组织的数据的容器（通常是一个文件或一组文件）。

表(table)：某种特定类型数据的结构化清单。

数据库中的每个表都有一个名字，用来标识自己。此名字是唯一的，同一个数据库中不能有名字相同的表。

表具有一些特性，这些特性定义了数据在表中如何存储，如可以存储什么样的数据，数据如何分解，各部分信息如何命名，等等。描述表
的这组信息就是所谓的模式，模式可以用来描述数据库中特定的表以及整个数据库（和其中表的关系）。

模式(schema)：关于数据库和表的布局及特性的信息。

行(row)：表中的一个记录。

列(column)：表中的一个字段。所有表都是由一个或多个列组成的。

主键(primary key)：一列（或一组列），其值能够唯一区分表中每个行。

主键的一些良好习惯：

- 不更新逐渐列中的值。
- 不重用主键列的值。
- 不在主键列中使用可能会更改的值。

# MySQL基本命令

## 1 登录

```shell
C:\Users\liuqi>mysql -u root -p -h localhost -P 3306
Enter password: ****
```

默认端口为3306，且默认主机IP为localhost。

## 2 选择数据库

```shell
mysql> #show databases命令在控制台输出数据库列表，结尾需要加分号
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| k8s_svc            |
| mybatis            |
| mysql              |
| performance_schema |
| ssmbuild           |
| sys                |
+--------------------+
7 rows in set (0.24 sec)

mysql> #use命令改变或打开需要操作的数据库
mysql> use k8s_svc;
Database changed
```

## 3 show命令

| 命令                                       | 描述                        |
| ------------------------------------------ | --------------------------- |
| `show databases`                           | 输出数据库列表              |
| `show tables`                              | 输出当前数据库table列表     |
| `show columns from xxx`                    | 输出xxx表中的列信息         |
| `show create database xxx`                 | 创建xxx数据库的语句         |
| `show create table databasename.tablename` | 创建当前数据库中xxx表的语句 |
| `show grants`                              | 授权信息                    |

```shell
#展示当前数据库的所有表
mysql> show tables;
+-------------------+
| Tables_in_k8s_svc |
+-------------------+
| svc               |
+-------------------+
1 row in set (0.00 sec)

#展示某个表的列数据
mysql> show columns from svc;
+---------+------------------+------+-----+---------+----------------+
| Field   | Type             | Null | Key | Default | Extra          |
+---------+------------------+------+-----+---------+----------------+
| svcName | varchar(255)     | NO   |     | NULL    |                |
| podIP   | varchar(255)     | YES  |     | NULL    |                |
| index   | int(32) unsigned | NO   | PRI | NULL    | auto_increment |
| port    | int(16)          | YES  |     | NULL    |                |
+---------+------------------+------+-----+---------+----------------+
4 rows in set (0.00 sec)

#展示建立数据库的语句
mysql> show create database k8s_svc;
+----------+------------------------------------------------------------------+
| Database | Create Database                                                  |
+----------+------------------------------------------------------------------+
| k8s_svc  | CREATE DATABASE `k8s_svc` /*!40100 DEFAULT CHARACTER SET utf8 */ |
+----------+------------------------------------------------------------------+
1 row in set (0.00 sec)

#展示建表语句
mysql> show create table svc;
+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                                                                                                                                                               |
+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| svc   | CREATE TABLE `svc` (
  `svcName` varchar(255) NOT NULL,
  `podIP` varchar(255) DEFAULT NULL,
  `index` int(32) unsigned NOT NULL AUTO_INCREMENT,
  `port` int(16) DEFAULT NULL,
  PRIMARY KEY (`index`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8 |
+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

#展示授权
mysql> show grants;
+---------------------------------------------------------------------+
| Grants for root@localhost                                           |
+---------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION |
| GRANT PROXY ON ''@'' TO 'root'@'localhost' WITH GRANT OPTION        |
+---------------------------------------------------------------------+
2 rows in set (0.00 sec)
```

可执行`help show;`获取更多show的用法。

> 在`Mysql`中可以使用describe xxx代替show xxx xxx。

## 4 select命令

1. 检索单个列：`SELECT prod_name FROM products;`

2. 检索多个列：`SELECT prod_id,prod_name FROM products;`

3. 检索所有列：`SELECT * FROM products;`

4. 检索不同的行：DISTINCT关键字

```shell
# 不输出重复的行
mysql> SELECT DISTINCT vend_id FROM products;
+---------+
| vend_id |
+---------+
|    1001 |
|    1002 |
|    1003 |
|    1005 |
+---------+
4 rows in set (0.03 sec)
```

5. 限制结果数量（LIMIT）

```sheell
SELECT prod_name FROM products LIMIT 5;
```

需要得到下五行时：

```shell
# 第一个5为索引，第二个为限制的行的数量
SELECT prod_name FROM products LIMIT 5,5;
```

**行的索引是从0开始的。**

LIMIT 1,1检索出的是第二行。

## 5 排序数据

ORDER BY字句取一个或多个列的名字，据此对输出进行排序。

```shell
# 以字母序对prod_name进行过排序
mysql> SELECT prod_name FROM products ORDER BY prod_name;
+----------------+
| prod_name      |
+----------------+
| .5 ton anvil   |
| 1 ton anvil    |
| 2 ton anvil    |
| Bird seed      |
| Carrots        |
| Detonator      |
| Fuses          |
| JetPack 1000   |
| JetPack 2000   |
| Oil can        |
| Safe           |
| Sling          |
| TNT (1 stick)  |
| TNT (5 sticks) |
+----------------+
14 rows in set (0.03 sec)
# 按照price和name的字母序进行排序（价格相同时再按name排序）
mysql> SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price,prod_name;
+---------+------------+----------------+
| prod_id | prod_price | prod_name      |
+---------+------------+----------------+
| FC      | 2.50       | Carrots        |
| TNT1    | 2.50       | TNT (1 stick)  |
| FU1     | 3.42       | Fuses          |
| SLING   | 4.49       | Sling          |
| ANV01   | 5.99       | .5 ton anvil   |
| OL1     | 8.99       | Oil can        |
| ANV02   | 9.99       | 1 ton anvil    |
| FB      | 10.00      | Bird seed      |
| TNT2    | 10.00      | TNT (5 sticks) |
| DTNTR   | 13.00      | Detonator      |
| ANV03   | 14.99      | 2 ton anvil    |
| JP1000  | 35.00      | JetPack 1000   |
| SAFE    | 50.00      | Safe           |
| JP2000  | 55.00      | JetPack 2000   |
+---------+------------+----------------+
14 rows in set (0.03 sec)
```

降序排列(DESC, descending)：

```shell
mysql> SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC;
+---------+------------+----------------+
| prod_id | prod_price | prod_name      |
+---------+------------+----------------+
| JP2000  | 55.00      | JetPack 2000   |
| SAFE    | 50.00      | Safe           |
| JP1000  | 35.00      | JetPack 1000   |
| ANV03   | 14.99      | 2 ton anvil    |
| DTNTR   | 13.00      | Detonator      |
| FB      | 10.00      | Bird seed      |
| TNT2    | 10.00      | TNT (5 sticks) |
| ANV02   | 9.99       | 1 ton anvil    |
| OL1     | 8.99       | Oil can        |
| ANV01   | 5.99       | .5 ton anvil   |
| SLING   | 4.49       | Sling          |
| FU1     | 3.42       | Fuses          |
| FC      | 2.50       | Carrots        |
| TNT1    | 2.50       | TNT (1 stick)  |
+---------+------------+----------------+
14 rows in set (0.03 sec)
# 价格降序，价格相同时产品名升序
mysql> SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC, prod_name;
+---------+------------+----------------+
| prod_id | prod_price | prod_name      |
+---------+------------+----------------+
| JP2000  | 55.00      | JetPack 2000   |
| SAFE    | 50.00      | Safe           |
| JP1000  | 35.00      | JetPack 1000   |
| ANV03   | 14.99      | 2 ton anvil    |
| DTNTR   | 13.00      | Detonator      |
| FB      | 10.00      | Bird seed      |
| TNT2    | 10.00      | TNT (5 sticks) |
| ANV02   | 9.99       | 1 ton anvil    |
| OL1     | 8.99       | Oil can        |
| ANV01   | 5.99       | .5 ton anvil   |
| SLING   | 4.49       | Sling          |
| FU1     | 3.42       | Fuses          |
| FC      | 2.50       | Carrots        |
| TNT1    | 2.50       | TNT (1 stick)  |
+---------+------------+----------------+
14 rows in set (0.03 sec)
```

DESC仅作用于位于它前面的一个列，如果想对多个列降序排列，需要对每个列都添加DESC关键字。与DESC相反的关键字是ASC(ascending)，默认为升序排列。

**在字典序中，A和a视为是相同的。**

**ORDER BY子句的位置**：在给出ORDER BY子句时，应该保证它位于FROM子句之后。如果使用LIMIT，它必须位于ORDER BY之后。使用子句的次序不对将产生错误消息。

## 6 过滤数据

在SELECT语句中，数据根据WHERE子句中指定的搜索条件进行过滤。WHERE子句在表名（FROM子句）之后给出。

`SELECT prod_name,prod_price FROM products WHERE prod_price=2.50;`

WHERE子句的操作符：

| 操作符  | 描述     |
| ------- | -------- |
| =       | 等于     |
| <>      | 不等于   |
| !=      | 不等于   |
| <       | 小于     |
| <=      | 小于等于 |
| >       | 大于     |
| >=      | 大于等于 |
| BETWEEN | 在…之间  |

当一个值需要与字符串进行比较时，需要将值扩在单引号内，与数值比较时则不需要。

```shell
mysql> SELECT prod_id,prod_price,prod_name FROM products WHERE prod_name <> 'Safe';
+---------+------------+----------------+
| prod_id | prod_price | prod_name      |
+---------+------------+----------------+
| ANV01   | 5.99       | .5 ton anvil   |
| ANV02   | 9.99       | 1 ton anvil    |
| ANV03   | 14.99      | 2 ton anvil    |
| DTNTR   | 13.00      | Detonator      |
| FB      | 10.00      | Bird seed      |
| FC      | 2.50       | Carrots        |
| FU1     | 3.42       | Fuses          |
| JP1000  | 35.00      | JetPack 1000   |
| JP2000  | 55.00      | JetPack 2000   |
| OL1     | 8.99       | Oil can        |
| SLING   | 4.49       | Sling          |
| TNT1    | 2.50       | TNT (1 stick)  |
| TNT2    | 10.00      | TNT (5 sticks) |
+---------+------------+----------------+
13 rows in set (0.04 sec)
# 检索范围内的值对应的行
mysql> SELECT prod_price,prod_name FROM products WHERE prod_price BETWEEN 5 AND 10;
+------------+----------------+
| prod_price | prod_name      |
+------------+----------------+
| 5.99       | .5 ton anvil   |
| 9.99       | 1 ton anvil    |
| 10.00      | Bird seed      |
| 8.99       | Oil can        |
| 10.00      | TNT (5 sticks) |
+------------+----------------+
5 rows in set (0.03 sec)
```

通过IS NULL子句，可以检查表中的空值NULL。

```shell
mysql> SELECT prod_name FROM products WHERE prod_price IS NULL;
Empty set
```

通过过滤选择出不具有特定值的行时，结果中不会包含具有NULL的行，因为NULL有特殊的含义，无法进行匹配。

### 组合where子句

MySQL允许多个WHERE子句之间通过AND或OR来组合，实现更复杂的过滤控制。

`SELECT prod_id,prod_price,prod_name FROM products WHERE vend_id=1003 AND prod_price <= 10;`

`SELECT prod_id,prod_price,prod_name FROM products WHERE vend_id=1003 OR vend_id = 1002;`

WHERE子句可以包含任意数量的AND和OR操作符，AND操作符的优先级高于OR。建议尽量使用圆括号明确地指定操作符的结合关系，提高代码的可读性。

```shell
mysql> SELECT prod_name,prod_price FROM products WHERE (vend_id=1002 OR vend_id=1003) AND prod_price >= 10;
+----------------+------------+
| prod_name      | prod_price |
+----------------+------------+
| Detonator      | 13.00      |
| Bird seed      | 10.00      |
| Safe           | 50.00      |
| TNT (5 sticks) | 10.00      |
+----------------+------------+
4 rows in set (0.03 sec)
```



IN操作符用来指定条件范围，范围中的每个条件都可以进行匹配。IN取合法值的由逗号分隔的清单，全都括在圆括号内。

```shell
mysql> SELECT prod_name,prod_price FROM products WHERE vend_id IN (1000,1001,1002);
+--------------+------------+
| prod_name    | prod_price |
+--------------+------------+
| .5 ton anvil | 5.99       |
| 1 ton anvil  | 9.99       |
| 2 ton anvil  | 14.99      |
| Fuses        | 3.42       |
| Oil can      | 8.99       |
+--------------+------------+
5 rows in set (0.03 sec)
```

